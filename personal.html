<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>个人信息</title>
	<link rel="stylesheet" type="text/css" href="./layui/css/layui.css" />
	<link rel="stylesheet" href="./css/css.css" />
	<link rel="stylesheet" href="./css/media.css" />
</head>

<body>
	<!--头部 开始-->
	<div class="nav_box">
		<div class="logo">
			<img src="./img/公司logo1.jpg" alt="">
		</div>
		<div class="titlew">
			<h3>海南圣源实业发展有限公司</h3>
		</div>
		<div class="nav">

			<ul>
				<li>
					<a href="./index.html">首页</a>
				</li>
				<li>
					<a href="./resolvent.html">解决方案</a>
				</li>
				<li>
					<a href="./product_center.html">产品中心</a>
				</li>
				<li>
					<a href="./agent_cooperation.html">代理合作</a>
				</li>
				<li>
					<a href="./about.html">关于我们</a>
				</li>
				<li>
					<a href="http://www.hainsy.com/web_admin/#">进入店铺</a>
				</li>
				<li>
					<a href="./download.html">下载驱动</a>
				</li>
			</ul>
		</div>
		<div class="login_box rightheade">
			<img class="touxian" src="" alt="头像" />
			<span class="user_name"></span>
			<span class="fine">下午好!</span>
		</div>

	</div>
	<div class="nav_yc_box">
		<ul class="nav_ul">
			<li class="li">
				<a href="./index.html">首页</a>
			</li>
			<li class="li">
				<a href="./resolvent.html">解决方案</a>
			</li>
			<li class="li">
				<a href="./product_center.html">产品中心</a>
			</li>
			<li class="li">
				<a href="./agent_cooperation.html">代理合作</a>
			</li>
			<li class="li">
				<a href="./about.html">关于我们</a>
			</li>
			<li class="li">
				<a href="http://www.hainsy.com/web_admin/#">进入店铺</a>
			</li>
			<li class="li">
				<a href="./download.html">下载驱动</a>
			</li>
			<li>
				<a YQ-location="examine" YQ-href="/login.html">登录</a>
			</li>
			<li>
				<a YQ-location="examine" YQ-href="/register.html">注册</a>
			</li>
		</ul>
	</div>
	<!--头部 结束-->

	<div class="my-contant layui-row">
		<div class="contant-1">
			<form class="layui-form" action="/personal" method="POST">
				<div class="layui-form-item">
					<label class="layui-form-label">账号</label>
					<div class="layui-input-block zhanghao">
						<input type="text" value="y123456" id="userName" name="name_username" style="display:none">
						<span id="uerName"></span>
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">原密码</label>
					<div class="layui-input-inline zhanghao">
						<input type="text" name="password" required lay-verify="required" id="passwrd" placeholder="请输原始密码" lay-vertype="tips" autocomplete="off"
						 class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">新密码</label>
					<div class="layui-input-inline zhanghao">
						<input type="text" name="password" required lay-verify="required" id="passwrod2" lay-vertype="tips" placeholder="请输新密码" value=""
						 autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">手机号</label>
					<div class="layui-input-block" id="daPhop">
						<input type="number" name="name_phonp" lay-vertype="tips" placeholder="请输入手机号" id="phonp" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">邮箱号</label>
					<div class="layui-input-block" id="daEmail">
						<input type="email" name="name_email" placeholder="请输入邮箱" id="email" class="layui-input">
					</div>
				</div>
				<div id="erroe-text" class="layui-form-item" style="color:red;text-align: center;"></div>
				<div class="layui-form-item my-forter">
					<div class="layui-input-block">
						<!-- <button class="layui-btn" lay-submit lay-filter="formDemo" onclick="addData()">保存</button> -->
						<input type="button" data-method="confirmTrans" class="layui-btn" id="btn" onclick="addData()" value="保存" />
						<button type="reset" class="layui-btn layui-btn-primary">取消</button>
					</div>
				</div>
			</form>
		</div>
	</div>

	<script type="text/javascript" src="./js/jquery.min.js"></script>
	<script type="text/javascript" src="./layui/layui.js"></script>
	<script>		
		var timer; //全局变量	

		function fine() {
			var xhr = new XMLHttpRequest;
			var oUernsme = document.getElementsByClassName('user_name');
			var oUserName = document.getElementById('userName');

			oUserName.value = oUernsme[0].innerHTML;
			console.log(oUserName)
			console.log(oUernsme[0].innerHTML)
			xhr.open('GET', '/ajax_data?user_name=' + oUernsme[0].innerHTML);
			xhr.send();

			xhr.onreadystatechange = function () {
				if (xhr.readyState === 4) {
					var data_1 = JSON.parse(xhr.responseText);
					console.log(data_1);

					document.getElementById('uerName').innerHTML = data_1.user_name;


				}
			}
		}

		fine();

		function addData() {
			var xhr = new XMLHttpRequest;
			var oUernsme = document.getElementsByClassName('user_name');
			var oPasswrd = document.getElementById('passwrd');
			var oPasswrod2 = document.getElementById('passwrod2');
			var oErroe = document.getElementById('erroe-text');
			var oBtn = document.getElementById('btn');
			var oUserName = document.getElementById('userName').value;
			var oPhonp = document.getElementById('phonp').value;
			var oEmail = document.getElementById('email').value;

			console.log(oUserName);

			xhr.open('GET', '/ajax_data?user_name=' + oUserName);

			xhr.send();

			xhr.onreadystatechange = function () {
				if (xhr.readyState === 4) {
					var data = JSON.parse(xhr.responseText);
					console.log(data);

					if (oPasswrod2.value.length > 20 || oPasswrod2.value.length < 6) {
						oErroe.innerHTML = "密码请输入6-20位字符"
						return;
					} else if (oPasswrd.value != data.user_passw) { //把输入的值于请求的值对比
						oErroe.innerHTML = "输入的原密码有误，请重新输入"
						return;
					} else if (oPasswrd.value === data.user_passw) {
						oErroe.innerHTML = "";
					}

					console.log(oPhonp.length);
					//手机正则
					var mPattern = /^((13[0-9])|(14[5|7])|(15([0-3]|[5-9]))|(18[0,5-9]))\d{8}$/;
					//输出 true
					console.log(mPattern.test(oPhonp));
					if (!mPattern.test(oPhonp)) {
						oErroe.innerHTML = "请输入正确的手机号"
						return;
					} else {
						oErroe.innerHTML = "";
					}

					//验证手机
					var Email = /^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/;
					console.log(Email.test(oEmail))
					if (!Email.test(oEmail)) {
						oErroe.innerHTML = "请输入正确的邮箱号"
						return;
					} else {
						oErroe.innerHTML = "";
						//弹框

						layui.use('layer', function () {
							var layer = layui.layer;
							layer.msg('保存成功');

						});
						//设置延时器
						window.setTimeout(function () {
							console.log('延时启动过')
							oBtn.form.submit();
						}, 1000);
					}
				}
			}
		}
	</script>
	<div class="layui-footer record">
		<div style="width:400px;margin:0 ;display: inline;">
			<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=46902302000182 " style="display:inline-block;text-decoration:none;height:20px;line-height:20px;">
				<img src="./img/备案图标.png" style="" />
				<span style=" color:#939393;">琼公网安备 46902302000182号</span>
			</a>
		</div> |
		<div style="display: inline;">琼ICP备18000468号-1</div>
	</div>
</body>
<script src="./js/YQ-location.js"></script>

</html>